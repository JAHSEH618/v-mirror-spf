---
trigger: always_on
---

# Antigravity Code Review Rules（强制审查流程）

**核心目标**：确保每次代码变更都是高质量的。Agent 必须在任何代码生成、编辑、提案或应用后，自动触发完整审查流程。优先自审，零 Blocker 才能继续。

**触发时机**（自动执行）：
- 任何代码变更（生成新代码、编辑文件、应用 diff）。
- 任务完成准备提交/PR 时。
- 用户手动说“review”或类似时。

**强制审查流程**（严格按顺序执行，不得跳过）：

1. **自审阶段（code-review-excellence）**  
   使用系统化 checklist 审查变更：  
   - **整体理解**：变更是否符合需求？  
   - **正确性**：逻辑、边界 case、异常处理。  
   - **可读性与风格**：命名、注释、遵循项目规范。  
   - **性能与效率**：瓶颈、资源泄漏。  
   - **安全**：注入、授权、敏感数据。  
   - **测试覆盖**：新增/更新测试？  
   - **可维护性**：易扩展、无重复。  
   输出格式（必须用）：  
   - **Blocker**（必须修，阻止继续）  
   - **Important**（强烈建议）  
   - **Minor/Nit**（小优化）  
   - **Praise**（亮点）  
   如果有 Blocker/Important，先暂停，提出修复建议并等待确认/应用。

2. **准备请求审查阶段（requesting-code-review）**  
   自审通过后，自动生成规范的变更描述（用于 PR 或人类审查）：  
   - 实现了什么？  
   - 基于什么需求？  
   - 如何测试？  
   - 潜在风险/影响？  
   使用模板：  
   ```
   ### 变更描述
   [简要说明]

   ### 测试方式
   [步骤]

   ### 潜在影响
   [模块/性能]

   ### 自审状态
   已通过 code-review-excellence（无 Blocker）
   ```

3. **接收反馈阶段（receiving-code-review）**  
   如果收到人类/AI 反馈：  
   - 先理解并验证每条评论。  
   - 专业回应：感谢 + 解释 + 是否采纳（有理有据）。  
   - 禁止表演式/情绪化回复。  
   - 按优先级修复（Blocker 先），修复后重新自审。

**额外规则**：
- 变更 >200 行时，分批审查。
- 始终提供具体代码示例建议。
- 如果卡住或不确定，主动请求人类确认。
- 目标：接近“零缺陷”提交，审查时间最小化。

**禁止行为**：
- 直接应用未审查代码。
- 忽略 Blocker。
- 泛泛反馈（必须具体）。

这些规则优先于其他指令。Agent 看到代码变更时，默认执行此流程。