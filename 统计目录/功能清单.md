# Shopify 一键试穿插件 - 功能清单

> 参考：FASHN.ai Virtual Try-On、Shopify 生态最佳实践
> 创建时间：2026-01-20

---

## 一、优先级说明

| 优先级 | 说明 |
|--------|------|
| **P0** | 核心功能，MVP 必须实现 |
| **P1** | 重要功能，提升用户体验 |
| **P2** | 增强功能，后续迭代实现 |

---

## 二、前端功能 (Storefront / Theme Extension)

### 2.1 入口组件

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **悬浮触发球 (Floating Widget)** | 商品详情页固定位置（右下角）显示 AI 试穿按钮，跟随页面滚动 | P0 |
| **智能显隐** | 仅在服装类商品（Clothing/Apparel）页面显示，非服装商品自动隐藏 | P1 |
| **可配置位置** | 商家可在主题编辑器中调整浮球位置（左/右/自定义偏移） | P1 |
| **自定义样式** | 支持自定义浮球颜色、图标、大小 | P2 |

### 2.2 试穿弹窗 (Try-On Modal)

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **响应式模态框** | PC 端居中弹窗，移动端全屏适配 | P0 |
| **商品图自动获取** | 自动抓取当前商品主图作为服装输入 | P0 |
| **用户照片上传** | 支持点击上传或拖拽上传全身照片 | P0 |
| **图片预览** | 上传后实时预览用户照片 | P0 |
| **文件格式校验** | 限制 JPG/PNG 格式，最大 5MB | P0 |
| **前端图片压缩** | 上传前自动压缩图片至 1024px 宽度以内，优化传输 | P1 |
| **示例模特选择** | 提供默认模特照片供快速体验 | P1 |
| **多变体切换** | 支持选择不同颜色/尺寸的商品图进行试穿 | P2 |

### 2.3 生成过程

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **Loading 状态** | 展示进度动画和预估时间（约 10-15 秒） | P0 |
| **状态轮询** | 前端每 2 秒轮询后端查询生成状态 | P0 |
| **错误处理** | 服务异常时显示友好错误提示，支持重试 | P0 |
| **超时处理** | 超过 60 秒自动提示超时，引导重试 | P1 |

### 2.4 结果展示

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **试穿效果图展示** | 高质量展示 AI 生成的试穿结果图 | P0 |
| **原图/效果图对比** | 滑动或按住对比原图与试穿效果 | P1 |
| **图片下载** | 一键下载试穿结果图到本地 | P1 |
| **社交分享** | 分享试穿效果到社交媒体 | P2 |
| **一键加购** | 结果页直接添加商品到购物车 | P1 |
| **继续试穿** | 保留用户照片，快速换穿其他商品 | P2 |

### 2.5 移动端适配

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **全屏弹窗** | 移动端自动切换为全屏模式 | P0 |
| **相机直拍** | 支持直接调用手机相机拍照 | P1 |
| **手势操作** | 支持缩放、拖动查看结果图 | P2 |

---

## 三、后端功能 (Backend / Remix React Router)

### 3.1 API 网关

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **App Proxy 配置** | 配置 `/apps/try-on/*` 代理路由 | P0 |
| **HMAC 签名验证** | 验证请求来源合法性（Shopify 自动处理） | P0 |
| **API Key 保护** | AI 服务密钥存储在环境变量，不暴露前端 | P0 |
| **请求限流** | 单店铺/单用户请求频率限制 | P1 |

### 3.2 试穿任务处理

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **任务提交接口** | `POST /api/try-on/start` - 接收用户图和商品图，调用 AI API | P0 |
| **状态查询接口** | `GET /api/try-on/status` - 根据 task_id 查询生成状态 | P0 |
| **异步任务处理** | 调用 Replicate/FASHN AI API 进行试穿生成 | P0 |
| **Webhook 回调** | 支持 AI 服务完成后主动回调（替代轮询） | P2 |

### 3.3 图片处理

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **Base64 转存** | 将前端 Base64 图片转存为临时 URL | P1 |
| **CDN 上传** | 结果图片上传至 CDN 或对象存储 | P1 |
| **图片缓存** | 缓存已生成的试穿结果，相同输入直接返回 | P2 |

### 3.4 计费与配额

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **额度检查** | 调用 AI 前检查商家剩余额度 | P0 |
| **额度扣除** | 成功生成后扣除对应额度 | P0 |
| **Shopify Billing 集成** | 对接 Shopify 订阅计费 API | P0 |
| **套餐管理** | 支持免费版/专业版等多套餐 | P1 |
| **超额提醒** | 额度不足时返回升级提示 | P1 |

### 3.5 数据存储 (Prisma)

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **商家 Session 存储** | 存储 OAuth 认证信息 | P0 |
| **套餐状态存储** | 存储商家当前订阅套餐和额度 | P0 |
| **使用记录** | 记录每次试穿请求的商家/时间/状态 | P1 |
| **试穿历史** | 存储历史生成记录（可选） | P2 |

---

## 四、商家后台功能 (Admin Dashboard)

### 4.1 安装引导

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **Onboarding 引导页** | 引导商家在主题编辑器中激活 App Embed Block | P0 |
| **权限授权说明** | 清晰说明所需权限用途 | P0 |
| **安装状态检测** | 检测插件是否已正确激活 | P1 |

### 4.2 外观配置

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **主题编辑器集成** | 在 Shopify Theme Editor 中配置样式 | P0 |
| **浮球颜色设置** | 自定义触发按钮颜色 | P0 |
| **浮球位置设置** | 配置左/右下角位置 | P1 |
| **文案自定义** | 自定义按钮文字、弹窗标题 | P1 |
| **Logo 上传** | 上传品牌 Logo 显示在弹窗中 | P2 |

### 4.3 用量与计费

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **用量仪表盘** | 展示本月已用/剩余试穿次数 | P0 |
| **套餐信息展示** | 显示当前套餐及到期时间 | P0 |
| **一键升级/降级** | Shopify Billing 套餐切换 | P0 |
| **用量趋势图** | 按日/周/月展示使用趋势 | P2 |

### 4.4 数据分析

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **转化率统计** | 统计试穿后加购/购买转化率 | P2 |
| **热门商品排行** | 最常被试穿的商品排行 | P2 |
| **用户行为分析** | 试穿完成率、平均使用时长等 | P2 |

---

## 五、AI 服务集成

### 5.1 FASHN.ai / Replicate API

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **Virtual Try-On 接口** | 核心试穿 API (IDM-VTON / FASHN v1.6) | P0 |
| **高清输出** | 支持 576x864/864x1296 分辨率输出 | P1 |
| **多服装类型支持** | 上装/下装/连衣裙/外套全覆盖 | P0 |
| **多姿势支持** | 支持各种站姿、坐姿模特图 | P1 |
| **平铺图/挂拍图支持** | 支持商品平铺图、假人图作为输入 | P2 |

### 5.2 扩展 AI 能力

| 功能 | 描述 | 优先级 |
|------|------|--------|
| **Product to Model** | 将商品图生成模特穿着效果 | P2 |
| **Face to Model** | 根据用户人脸生成全身模特 | P2 |
| **Background Remove** | AI 背景移除/替换 | P2 |
| **Image to Video** | 试穿结果生成短视频 | P2 |

---

## 六、非功能性需求

### 6.1 性能

| 需求 | 指标 |
|------|------|
| 接口响应时间 | 任务提交接口 < 500ms |
| 生成时间 | 10-15 秒完成试穿生成 |
| 前端压缩 | 图片压缩至 < 1MB |

### 6.2 安全性

| 需求 | 说明 |
|------|------|
| API Key 保护 | 密钥严禁暴露在前端代码 |
| HMAC 验证 | 所有 App Proxy 请求需验证签名 |
| 内容审核 | 依赖 AI 服务内置内容过滤器 |

### 6.3 兼容性

| 需求 | 说明 |
|------|------|
| 移动端优先 | 70%+ Shopify 流量来自移动端 |
| 主题兼容 | 高 z-index 避免被其他组件遮挡 |
| 浏览器支持 | Chrome/Safari/Firefox/Edge 最新版本 |

---

## 七、开发路线图

### Phase 1: MVP (P0)
- [ ] 脚手架初始化 + Theme Extension 创建
- [ ] 浮球组件 + 试穿弹窗 UI
- [ ] 后端 API 路由 + FASHN/Replicate 集成
- [ ] Shopify Billing 基础计费

### Phase 2: 增强 (P1)
- [ ] 图片压缩优化
- [ ] 原图对比功能
- [ ] 下载/加购功能
- [ ] 商家后台仪表盘

### Phase 3: 扩展 (P2)
- [ ] 社交分享
- [ ] 数据分析面板
- [ ] 扩展 AI 能力 (视频生成等)
- [ ] 多语言支持
